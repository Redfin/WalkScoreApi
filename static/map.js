var map;

var testRoute = {
  "category": "Bus",
  "agency": "Metro Transit",
  "name": "99",
  "geometry_wkt": "LINESTRING(-122.322449 47.598351,-122.323097 47.598351,-122.323761 47.598351,-122.323753 47.599190,-122.324394 47.599194,-122.325058 47.599194,-122.326363 47.599194,-122.327011 47.599194,-122.327667 47.599201,-122.327927 47.599194,-122.328064 47.599201,-122.328995 47.599201,-122.329102 47.599201,-122.329216 47.599201,-122.329681 47.599201,-122.330223 47.599205,-122.330276 47.599201,-122.331581 47.599205,-122.332886 47.599205,-122.333023 47.599205,-122.334183 47.599205,-122.334183 47.599270,-122.334183 47.599339,-122.334183 47.600044,-122.334183 47.600079,-122.334183 47.600887,-122.334183 47.601513,-122.334183 47.601726,-122.334175 47.602440,-122.334282 47.602558,-122.334351 47.602627,-122.334801 47.603119,-122.334885 47.603203,-122.334938 47.603275,-122.335228 47.603577,-122.335281 47.603638,-122.335594 47.603981,-122.336235 47.604691,-122.336891 47.605404,-122.337479 47.606049,-122.337547 47.606117,-122.338203 47.606834,-122.339104 47.607826,-122.340019 47.608822,-122.340088 47.608898,-122.340919 47.609817,-122.340973 47.609867,-122.341347 47.610272,-122.341423 47.610371,-122.342613 47.611072,-122.343910 47.611839,-122.345207 47.612606,-122.346519 47.613373,-122.347710 47.614078,-122.347809 47.614136,-122.347832 47.614155,-122.348747 47.614697,-122.349693 47.615246,-122.350616 47.615799,-122.351547 47.616352,-122.352509 47.616920,-122.352928 47.616589,-122.353363 47.616253,-122.354225 47.615585,-122.354790 47.615158,-122.354843 47.615101,-122.354866 47.615055,-122.354881 47.615013,-122.354858 47.614952,-122.354797 47.614883,-122.354019 47.614429)",
  "agency_url": "http://metro.kingcounty.gov",
  "stop_ids": [
      "4acb42872963cfc997727e58fba6bdf43d2fbf2d",
      "82ce6a3d3c303dd8368b3e5de9d5791636e3b01b"
  ],
  "id": "6fffc9e7af7a9a444b12fd2ae2685281ab42bc1e"
};

function linestringToCoordinates(linestring) {
  return linestring
    .replace(/LINESTRING\(/i, '')
    .replace(/\)/i, '')
    .split(',')
    .map(function(coord) {
      var parts = coord.split(' ');
      return { lat: parseFloat(parts[1]), lng: parseFloat(parts[0]) };
    });
}

function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: { lat: 47.61, lng: -122.34 },
    zoom: 14
  });

  var routeCoords = linestringToCoordinates(testRoute.geometry_wkt);
  var route = new google.maps.Polyline({
      path: routeCoords,
      geodesic: true,
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2
    });
  route.setMap(map);
}
